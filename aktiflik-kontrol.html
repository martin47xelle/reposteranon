<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Anonim Chat Tracker</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f0f0f; color: #e0e0e0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .card { background: #1a1a1a; border: 1px solid #333; padding: 25px; border-radius: 20px; width: 320px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.5); z-index: 2; }
        #user-img { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 15px; border: 2px solid #007bff; display: none; margin-left: auto; margin-right: auto; }
        .time-badge { background: #252525; padding: 10px; border-radius: 10px; margin-top: 15px; }
        .relative-time { display: block; font-size: 1.2rem; font-weight: bold; color: #00ff88; margin-bottom: 5px; }
        .exact-time { font-size: 0.75rem; color: #888; }
        button { background: #007bff; color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 20px; transition: 0.2s; }
        button:hover { background: #0056b3; transform: scale(1.02); }

        /* Yeni Log Paneli Alanı */
        .log-container { margin-top: 20px; width: 320px; background: #1a1a1a; border: 1px solid #333; border-radius: 15px; max-height: 200px; overflow-y: auto; padding: 10px; font-size: 0.8rem; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .log-title { font-weight: bold; color: #888; margin-bottom: 8px; border-bottom: 1px solid #333; padding-bottom: 5px; display: flex; justify-content: space-between; }
        .log-entry { padding: 5px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .status-active { color: #00ff88; font-weight: bold; }
        .status-passive { color: #ff4444; }
    </style>
</head>
<body>

<div class="card">
    <img id="user-img" src="">
    <div style="font-weight: bold; margin-bottom: 5px;">budabisibeenmiyorha1</div>
    
    <div class="time-badge">
        <span id="rel-time" class="relative-time">Bekleniyor...</span>
        <span id="exact-time" class="exact-time">-</span>
    </div>

    <button id="ctrl-btn" onclick="sorgula()">KONTROL ET</button>
    <div id="countdown" style="font-size: 0.7rem; color: #555; margin-top: 10px;">Otomatik kontrol: Bekleniyor</div>
</div>

<div class="log-container">
    <div class="log-title"><span>AKTİFLİK LOGLARI</span> <span id="log-count">0</span></div>
    <div id="log-list"></div>
</div>

<script>
let logCounter = 0;

function addLog(status, time) {
    const logList = document.getElementById('log-list');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    
    const statusText = status.includes("saniye") ? '<span class="status-active">AKTİF</span>' : '<span class="status-passive">PASİF</span>';
    
    entry.innerHTML = `<span>${new Date().toLocaleTimeString()}</span> <span>${status}</span> ${statusText}`;
    logList.insertBefore(entry, logList.firstChild);
    
    logCounter++;
    document.getElementById('log-count').innerText = logCounter;
}

function timeAgo(date) {
    const now = new Date();
    const diffInSeconds = Math.floor((now - date) / 1000);

    if (diffInSeconds < 60) return `${diffInSeconds} saniye önce`;
    const diffInMinutes = Math.floor(diffInSeconds / 60);
    if (diffInMinutes < 60) return `${diffInMinutes} dakika önce`;
    const diffInHours = Math.floor(diffInMinutes / 60);
    if (diffInHours < 24) return `${diffInHours} saat önce`;
    
    return date.toLocaleDateString('tr-TR');
}

async function sorgula() {
    const relTimeText = document.getElementById('rel-time');
    const exactTimeText = document.getElementById('exact-time');
    const userImg = document.getElementById('user-img');
    const btn = document.getElementById('ctrl-btn');
    
    relTimeText.innerText = "Sorgulanıyor...";
    btn.disabled = true;

    const formData = new FormData();
    formData.append('username', 'whyudontlikeme');

    try {
        const response = await fetch('https://cors-anywhere.herokuapp.com/https://api.anonim.chat/api/1.2/users/show', {
            method: 'POST',
            headers: {
                'jwt': 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyNzcxOTMzMTY1ODQ4MjQsImFub24iOiI5ODA0YWI3MjRmODNjMTIiLCJoYXNoIjoiYTRlODY1MjkzOGMwMDkxOTZjOTIzNTFhMGM0NjBkMWEiLCJ0aW1lIjoxNzY2ODIzNjYzfQ.RcQIFWXTl3sz-mlFWQ8T7ng-Ivh6tyw08-DW3MdywX0',
                'Accept': '*/*'
            },
            body: formData
        });

        const data = await response.json();

        if (data.last_activity) {
            let date = new Date(data.last_activity.replace(/-/g, '/'));
            date.setHours(date.getHours() + 3);

            const resultText = timeAgo(date);
            relTimeText.innerText = resultText;
            exactTimeText.innerText = date.toLocaleString('tr-TR');
            
            userImg.src = data.image;
            userImg.style.display = "block";

            // Log ekleme
            addLog(resultText, date.toLocaleString('tr-TR'));
        }
    } catch (err) {
        relTimeText.innerText = "Hata!";
        console.error(err);
    } finally {
        btn.disabled = false;
        startTimer(45); // Her sorgu bittiğinde 45 saniyeyi tekrar başlat
    }
}

function startTimer(seconds) {
    let counter = seconds;
    const cdDisplay = document.getElementById('countdown');
    
    const interval = setInterval(() => {
        cdDisplay.innerText = `Sonraki kontrol: ${counter}s`;
        counter--;
        
        if (counter < 0) {
            clearInterval(interval);
            sorgula();
        }
    }, 1000);
}

// Sayfa açıldığında ilk sorguyu yap ve döngüyü başlat
window.onload = () => {
    sorgula();
};
</script>

</body>
</html>
